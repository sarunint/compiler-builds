{"version":3,"file":"i18n.js","sourceRoot":"","sources":["../../../../../../packages/compiler/src/render3/view/i18n.ts"],"names":[],"mappings":"AAAA;;;;;;GAMG;AAIH,oCAAoC;AACpC,MAAM,sBAAsB,GAAG,GAAG,CAAC;AACnC,MAAM,iBAAiB,GAAG,IAAI,CAAC;AAE/B,mCAAmC;AACnC,MAAM,CAAC,MAAM,SAAS,GAAG,MAAM,CAAC;AAChC,MAAM,CAAC,MAAM,gBAAgB,GAAG,OAAO,CAAC;AAExC,gDAAgD;AAChD,MAAM,CAAC,MAAM,uBAAuB,GAAG,GAAG,CAAC;AAE3C,yBAAyB;AACzB,YAAY;AACZ,yBAAyB;AACzB,gCAAgC;AAChC,MAAM,UAAU,aAAa,CAAC,IAAa;IACzC,IAAI,EAAoB,CAAC;IACzB,IAAI,OAAyB,CAAC;IAC9B,IAAI,WAA6B,CAAC;IAElC,IAAI,IAAI,EAAE;QACR,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;QAChD,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;QACvD,IAAI,cAAsB,CAAC;QAC3B,CAAC,cAAc,EAAE,EAAE,CAAC;YAChB,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QACpF,CAAC,OAAO,EAAE,WAAW,CAAC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YACvC,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,EAAE,cAAc,CAAC,KAAK,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YAC3E,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC;KAC1B;IAED,OAAO,EAAC,EAAE,EAAE,OAAO,EAAE,WAAW,EAAC,CAAC;AACpC,CAAC;AAED,MAAM,UAAU,eAAe,CAAC,IAAY;IAC1C,OAAO,IAAI,KAAK,SAAS,IAAI,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;AACjE,CAAC;AAED,MAAM,UAAU,mBAAmB,CAAC,OAAwB,EAAE,YAAoB,CAAC;IACjF,MAAM,OAAO,GAAG,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,SAAS,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;IACrD,OAAO,GAAG,uBAAuB,GAAG,OAAO,GAAG,OAAO,GAAG,uBAAuB,EAAE,CAAC;AACpF,CAAC;AAED,MAAM,UAAU,uBAAuB,CACnC,OAAsB,EAAE,oBAA4B,CAAC,EAAE,YAAoB,CAAC;IAC9E,IAAI,CAAC,OAAO,CAAC,MAAM;QAAE,OAAO,EAAE,CAAC;IAC/B,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,MAAM,OAAO,GAAG,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;IACnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,EAAE,CAAC,EAAE,EAAE;QAChC,GAAG,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,GAAG,mBAAmB,CAAC,iBAAiB,GAAG,CAAC,EAAE,SAAS,CAAC,EAAE,CAAC;KAChF;IACD,GAAG,IAAI,OAAO,CAAC,OAAO,CAAC,CAAC;IACxB,OAAO,GAAG,CAAC;AACb,CAAC;AAED,SAAS,qBAAqB,CAAC,WAAmB,CAAC;IACjD,IAAI,OAAO,GAAG,QAAQ,CAAC;IACvB,OAAO,GAAG,EAAE,CAAC,OAAO,EAAE,CAAC;AACzB,CAAC;AAQD;;;;;;;;GAQG;AACH,MAAM,OAAO,WAAW;IAKtB,YACY,KAAa,EAAU,aAA0B,EAAU,GAAQ,EACnE,QAAgB,CAAC,EAAU,WAA0B;QADrD,UAAK,GAAL,KAAK,CAAQ;QAAU,kBAAa,GAAb,aAAa,CAAa;QAAU,QAAG,GAAH,GAAG,CAAK;QACnE,UAAK,GAAL,KAAK,CAAY;QAAU,gBAAW,GAAX,WAAW,CAAe;QALzD,YAAO,GAAW,EAAE,CAAC;QACrB,aAAQ,GAAG,IAAI,GAAG,EAAgB,CAAC;QAKzC,IAAI,CAAC,WAAW,GAAG,WAAW,IAAI,qBAAqB,EAAE,CAAC;QAC1D,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;IAC/B,CAAC;IAEO,IAAI,CAAC,MAAc,EAAE,YAAoB,EAAE,SAAiB,EAAE,MAAgB;QACpF,MAAM,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC;QAChC,OAAO,mBAAmB,CAAC,GAAG,KAAK,GAAG,MAAM,GAAG,YAAY,EAAE,EAAE,SAAS,CAAC,CAAC;IAC5E,CAAC;IACO,MAAM,CAAC,OAAe,IAAI,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,CAAC,CAAC;IACpD,kBAAkB,CAAC,SAAwB,EAAE,UAAyB;QAC5E,OAAO,mBAAmB,CAAC,QAAQ,SAAS,IAAI,UAAU,EAAE,CAAC,CAAC;IAChE,CAAC;IAED,KAAK,KAAK,OAAO,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;IAC3B,MAAM,KAAK,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;IAC7B,QAAQ,KAAK,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;IACjC,UAAU,KAAK,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;IACrC,gBAAgB,KAAK,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;IAEjD,WAAW,KAAK,OAAO,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;IACvC,aAAa,CAAC,OAAqB,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;IAEpE,MAAM,KAAK,OAAO,IAAI,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC;IACrC,UAAU;QACR,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;QAClE,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACnC,CAAC;IAED,UAAU,CAAC,OAAe,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;IAC5D,cAAc,CAAC,KAAa,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;IACvF,aAAa,CAAC,YAAoB,EAAE,MAAgB;QAClD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,YAAY,EAAE,IAAI,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC;IAC7D,CAAC;IAED,gBAAgB,CAAC,KAAa,EAAE,aAAqB;QACnD,OAAO,IAAI,WAAW,CAAC,KAAK,EAAE,aAAa,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;IAC3F,CAAC;IACD,qBAAqB,CAAC,OAAoB;QACxC,MAAM,EAAE,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;QAC3B,MAAM,OAAO,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QACrC,MAAM,aAAa,GAAG,OAAO,CAAC,gBAAgB,EAAI,CAAC;QACnD,MAAM,OAAO,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,EAAE,aAAa,CAAC,CAAC,CAAC;QAC5E,MAAM,WAAW,GACb,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,aAAa,EAAE,EAAE,CAAC,GAAG,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,aAAa,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,CAAC;QAC/F,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;IAC5D,CAAC;CACF","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport * as o from '../../output/output_ast';\n\n/** I18n separators for metadata **/\nconst I18N_MEANING_SEPARATOR = '|';\nconst I18N_ID_SEPARATOR = '@@';\n\n/** Name of the i18n attributes **/\nexport const I18N_ATTR = 'i18n';\nexport const I18N_ATTR_PREFIX = 'i18n-';\n\n/** Placeholder wrapper for i18n expressions **/\nexport const I18N_PLACEHOLDER_SYMBOL = 'ï¿½';\n\n// Parse i18n metas like:\n// - \"@@id\",\n// - \"description[@@id]\",\n// - \"meaning|description[@@id]\"\nexport function parseI18nMeta(meta?: string): I18nMeta {\n  let id: string|undefined;\n  let meaning: string|undefined;\n  let description: string|undefined;\n\n  if (meta) {\n    const idIndex = meta.indexOf(I18N_ID_SEPARATOR);\n    const descIndex = meta.indexOf(I18N_MEANING_SEPARATOR);\n    let meaningAndDesc: string;\n    [meaningAndDesc, id] =\n        (idIndex > -1) ? [meta.slice(0, idIndex), meta.slice(idIndex + 2)] : [meta, ''];\n    [meaning, description] = (descIndex > -1) ?\n        [meaningAndDesc.slice(0, descIndex), meaningAndDesc.slice(descIndex + 1)] :\n        ['', meaningAndDesc];\n  }\n\n  return {id, meaning, description};\n}\n\nexport function isI18NAttribute(name: string): boolean {\n  return name === I18N_ATTR || name.startsWith(I18N_ATTR_PREFIX);\n}\n\nexport function wrapI18nPlaceholder(content: string | number, contextId: number = 0): string {\n  const blockId = contextId > 0 ? `:${contextId}` : '';\n  return `${I18N_PLACEHOLDER_SYMBOL}${content}${blockId}${I18N_PLACEHOLDER_SYMBOL}`;\n}\n\nexport function assembleI18nBoundString(\n    strings: Array<string>, bindingStartIndex: number = 0, contextId: number = 0): string {\n  if (!strings.length) return '';\n  let acc = '';\n  const lastIdx = strings.length - 1;\n  for (let i = 0; i < lastIdx; i++) {\n    acc += `${strings[i]}${wrapI18nPlaceholder(bindingStartIndex + i, contextId)}`;\n  }\n  acc += strings[lastIdx];\n  return acc;\n}\n\nfunction getSeqNumberGenerator(startsAt: number = 0): () => number {\n  let current = startsAt;\n  return () => current++;\n}\n\nexport type I18nMeta = {\n  id?: string,\n  description?: string,\n  meaning?: string\n};\n\n/**\n * I18nContext is a helper class which keeps track of all i18n-related aspects\n * (accumulates content, bindings, etc) between i18nStart and i18nEnd instructions.\n *\n * When we enter a nested template, the top-level context is being passed down\n * to the nested component, which uses this context to generate a child instance\n * of I18nContext class (to handle nested template) and at the end, reconciles it back\n * with the parent context.\n */\nexport class I18nContext {\n  private id: number;\n  private content: string = '';\n  private bindings = new Set<o.Expression>();\n\n  constructor(\n      private index: number, private templateIndex: number|null, private ref: any,\n      private level: number = 0, private uniqueIdGen?: () => number) {\n    this.uniqueIdGen = uniqueIdGen || getSeqNumberGenerator();\n    this.id = this.uniqueIdGen();\n  }\n\n  private wrap(symbol: string, elementIndex: number, contextId: number, closed?: boolean) {\n    const state = closed ? '/' : '';\n    return wrapI18nPlaceholder(`${state}${symbol}${elementIndex}`, contextId);\n  }\n  private append(content: string) { this.content += content; }\n  private genTemplatePattern(contextId: number|string, templateId: number|string): string {\n    return wrapI18nPlaceholder(`tmpl:${contextId}:${templateId}`);\n  }\n\n  getId() { return this.id; }\n  getRef() { return this.ref; }\n  getIndex() { return this.index; }\n  getContent() { return this.content; }\n  getTemplateIndex() { return this.templateIndex; }\n\n  getBindings() { return this.bindings; }\n  appendBinding(binding: o.Expression) { this.bindings.add(binding); }\n\n  isRoot() { return this.level === 0; }\n  isResolved() {\n    const regex = new RegExp(this.genTemplatePattern('\\\\d+', '\\\\d+'));\n    return !regex.test(this.content);\n  }\n\n  appendText(content: string) { this.append(content.trim()); }\n  appendTemplate(index: number) { this.append(this.genTemplatePattern(this.id, index)); }\n  appendElement(elementIndex: number, closed?: boolean) {\n    this.append(this.wrap('#', elementIndex, this.id, closed));\n  }\n\n  forkChildContext(index: number, templateIndex: number) {\n    return new I18nContext(index, templateIndex, this.ref, this.level + 1, this.uniqueIdGen);\n  }\n  reconcileChildContext(context: I18nContext) {\n    const id = context.getId();\n    const content = context.getContent();\n    const templateIndex = context.getTemplateIndex() !;\n    const pattern = new RegExp(this.genTemplatePattern(this.id, templateIndex));\n    const replacement =\n        `${this.wrap('*', templateIndex, id)}${content}${this.wrap('*', templateIndex, id, true)}`;\n    this.content = this.content.replace(pattern, replacement);\n  }\n}"]}